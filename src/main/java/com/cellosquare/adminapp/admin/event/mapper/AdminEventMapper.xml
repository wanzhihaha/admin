<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cellosquare.adminapp.admin.event.mapper.AdminEventMapper">

	<select id="getTotalCount" parameterType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO" resultType="int">
		SELECT COUNT(*)
		FROM MK_EVT
		WHERE LANG_CD = #{langCd}
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(searchType) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(searchType)">
			AND EVT_CCD = #{searchType}
		</if>
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(searchValue) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(searchValue)">
			AND TITLE_NM ILIKE CONCAT ('%', #{searchValue}, '%')
		</if>	
	</select>
	
	<select id="getList" parameterType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO" resultType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO">
		SELECT
			  A.EVT_SEQ_NO
			, A.META_SEQ_NO
			, A.LANG_CD
			, A.EVT_CCD
			, FN_GETCODENM('EVT_DIV', A.EVT_CCD, A.LANG_CD) AS EVT_CCD_NM
			, A.TITLE_NM
			, A.SUMMARY_INFO
			, A.PC_LIST_IMG_PATH
			, A.PC_LIST_IMG_ORG_FILE_NM
			, A.PC_LIST_IMG_FILE_NM
			, A.PC_LIST_IMG_SIZE
			, A.PC_LIST_IMG_ALT
			, A.PC_DETL_IMG_PATH
			, A.PC_DETL_IMG_ORG_FILE_NM
			, A.PC_DETL_IMG_FILE_NM
			, A.PC_DETL_IMG_SIZE
			, A.PC_DETL_IMG_ALT
			, A.MOBILE_LIST_IMG_PATH 
			, A.MOBILE_LIST_IMG_ORG_FILE_NM
			, A.MOBILE_LIST_IMG_FILE_NM
			, A.MOBILE_LIST_IMG_SIZE 
			, A.MOBILE_LIST_IMG_ALT
			, A.MOBILE_DETL_IMG_PATH 
			, A.MOBILE_DETL_IMG_ORG_FILE_NM
			, A.MOBILE_DETL_IMG_FILE_NM
			, A.MOBILE_DETL_IMG_SIZE 
			, A.MOBILE_DETL_IMG_ALT
			, A.EVT_DETL_CONTENT
			, TO_CHAR(TO_TIMESTAMP(EVT_STAT_DTM, 'YYYYMMDD'), 'YYYY-MM-DD') AS EVT_STAT_DTM
			, TO_CHAR(TO_TIMESTAMP(EVT_END_DTM, 'YYYYMMDD'), 'YYYY-MM-DD') AS EVT_END_DTM
			, FN_GETCODENM('NEW_TAB_LNK', A.NEW_WINDOW_LINK_YN, A.LANG_CD) AS NEW_WINDOW_LINK_YN_NM
			, A.NEW_WINDOW_LINK_YN
			, A.NEW_LINK
			, A.USE_YN
			, FN_GETCODENM('USE_YN', A.USE_YN, A.LANG_CD) AS USE_YN_NM
			, A.SRCH_CNT
			, A.ORDB
			, TO_CHAR(INS_DTM, 'YYYY-MM-DD') AS INS_DTM 
			, A.INS_PERSON_ID 
			, FN_GETMANAGERNM(A.INS_PERSON_ID) AS INS_PERSON_NM
			, TO_CHAR(UPD_DTM, 'YYYY-MM-DD') AS UPD_DTM
			, A.UPD_PERSON_ID
			, FN_GETMANAGERNM(A.UPD_PERSON_ID) AS UPD_PERSON_NM
		FROM MK_EVT A
		WHERE A.LANG_CD = #{langCd}
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(searchType) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(searchType)">
			AND EVT_CCD = #{searchType}
		</if>
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(searchValue) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(searchValue)">
			AND TITLE_NM ILIKE CONCAT ('%', #{searchValue}, '%')
		</if>
	ORDER BY A.EVT_SEQ_NO DESC
	LIMIT #{endRow} OFFSET #{startRow}
	</select>
	
	<select id="getImg" parameterType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO" resultType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO">
		SELECT
			  A.EVT_SEQ_NO
			, A.META_SEQ_NO
			, A.LANG_CD
			, A.EVT_CCD
			, FN_GETCODENM('EVT_DIV', A.EVT_CCD, A.LANG_CD) AS EVT_CCD_NM
			, A.TITLE_NM
			, A.SUMMARY_INFO
			, A.PC_LIST_IMG_PATH
			, A.PC_LIST_IMG_ORG_FILE_NM
			, A.PC_LIST_IMG_FILE_NM
			, A.PC_LIST_IMG_SIZE
			, A.PC_LIST_IMG_ALT
			, A.PC_DETL_IMG_PATH
			, A.PC_DETL_IMG_ORG_FILE_NM
			, A.PC_DETL_IMG_FILE_NM
			, A.PC_DETL_IMG_SIZE
			, A.PC_DETL_IMG_ALT
			, A.MOBILE_LIST_IMG_PATH 
			, A.MOBILE_LIST_IMG_ORG_FILE_NM
			, A.MOBILE_LIST_IMG_FILE_NM
			, A.MOBILE_LIST_IMG_SIZE 
			, A.MOBILE_LIST_IMG_ALT
			, A.MOBILE_DETL_IMG_PATH 
			, A.MOBILE_DETL_IMG_ORG_FILE_NM
			, A.MOBILE_DETL_IMG_FILE_NM
			, A.MOBILE_DETL_IMG_SIZE 
			, A.MOBILE_DETL_IMG_ALT
			, A.EVT_DETL_CONTENT
			, TO_CHAR(TO_TIMESTAMP(EVT_STAT_DTM, 'YYYYMMDD'), 'YYYY-MM-DD') AS EVT_STAT_DTM
			, TO_CHAR(TO_TIMESTAMP(EVT_END_DTM, 'YYYYMMDD'), 'YYYY-MM-DD') AS EVT_END_DTM
			, FN_GETCODENM('NEW_TAB_LNK', A.NEW_WINDOW_LINK_YN, A.LANG_CD) AS NEW_WINDOW_LINK_YN_NM
			, A.NEW_WINDOW_LINK_YN
			, A.NEW_LINK
			, A.USE_YN
			, FN_GETCODENM('USE_YN', A.USE_YN, A.LANG_CD) AS USE_YN_NM
			, A.SRCH_CNT
			, A.ORDB
			, TO_CHAR(INS_DTM, 'YYYY-MM-DD') AS INS_DTM 
			, A.INS_PERSON_ID 
			, FN_GETMANAGERNM(A.INS_PERSON_ID) AS INS_PERSON_NM
			, TO_CHAR(UPD_DTM, 'YYYY-MM-DD') AS UPD_DTM
			, A.UPD_PERSON_ID
			, FN_GETMANAGERNM(A.UPD_PERSON_ID) AS UPD_PERSON_NM
		FROM MK_EVT A
		WHERE 1=1
		AND A.EVT_SEQ_NO = #{evtSeqNo}::integer
	</select>

	<insert id="regist" parameterType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO">
	INSERT INTO MK_EVT (
		  META_SEQ_NO
		, LANG_CD
		, EVT_CCD
		, TITLE_NM
		, SUMMARY_INFO
		, PC_LIST_IMG_PATH
		, PC_LIST_IMG_ORG_FILE_NM
		, PC_LIST_IMG_FILE_NM
		, PC_LIST_IMG_SIZE
		, PC_LIST_IMG_ALT
		, PC_DETL_IMG_PATH
		, PC_DETL_IMG_ORG_FILE_NM
		, PC_DETL_IMG_FILE_NM
		, PC_DETL_IMG_SIZE
		, PC_DETL_IMG_ALT
		, MOBILE_LIST_IMG_PATH 
		, MOBILE_LIST_IMG_ORG_FILE_NM
		, MOBILE_LIST_IMG_FILE_NM
		, MOBILE_LIST_IMG_SIZE 
		, MOBILE_LIST_IMG_ALT
		, MOBILE_DETL_IMG_PATH 
		, MOBILE_DETL_IMG_ORG_FILE_NM
		, MOBILE_DETL_IMG_FILE_NM
		, MOBILE_DETL_IMG_SIZE 
		, MOBILE_DETL_IMG_ALT
		, EVT_DETL_CONTENT
		, EVT_STAT_DTM
		, EVT_END_DTM
		, NEW_WINDOW_LINK_YN
		, NEW_LINK
		, USE_YN
		, INS_DTM
		, INS_PERSON_ID
		, UPD_DTM
		, UPD_PERSON_ID
	) VALUES (
		  #{metaSeqNo}::integer
		, #{langCd}
		, #{evtCcd}
		, #{titleNm}
		, #{summaryInfo}
		, #{pcListImgPath}
		, #{pcListImgOrgFileNm}
		, #{pcListImgFileNm}
		, #{pcListImgSize}::integer
		, #{pcListImgAlt}
		, #{pcDetlImgPath}
		, #{pcDetlImgOrgFileNm}
		, #{pcDetlImgFileNm}
		, #{pcDetlImgSize}::integer
		, #{pcDetlImgAlt}
		, #{mobileListImgPath}
		, #{mobileListImgOrgFileNm}
		, #{mobileListImgFileNm}
		, #{mobileListImgSize}::integer
		, #{mobileListImgAlt}
		, #{mobileDetlImgPath}
		, #{mobileDetlImgOrgFileNm}
		, #{mobileDetlImgFileNm}
		, #{mobileDetlImgSize}::integer
		, #{mobileDetlImgAlt}
		, #{evtDetlContent}
		, #{evtStatDtm}
		, #{evtEndDtm}
		, #{newWindowLinkYn}
		, #{newLink}
		, #{useYn}
		<!-- , TO_DATE(#{frstRegistDt}, 'YYYY-MM-DD') -->
		, NOW()
		, #{insPersonId}
		, NOW()
		, #{updPersonId}
	)
	</insert>
	
	<update id="update" parameterType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO">
	UPDATE MK_EVT
	SET
		  TITLE_NM				       	 = #{titleNm}								 	
		, SUMMARY_INFO                   = #{summaryInfo}
		, EVT_CCD						 = #{evtCcd}
		, PC_LIST_IMG_PATH			     = #{pcListImgPath}
		, PC_LIST_IMG_ORG_FILE_NM        = #{pcListImgOrgFileNm}
		, PC_LIST_IMG_FILE_NM            = #{pcListImgFileNm}
		, PC_LIST_IMG_SIZE               = #{pcListImgSize}::integer
		, PC_LIST_IMG_ALT                = #{pcListImgAlt}
		, PC_DETL_IMG_PATH			 	 = #{pcDetlImgPath}
		, PC_DETL_IMG_ORG_FILE_NM      	 = #{pcDetlImgOrgFileNm}
		, PC_DETL_IMG_FILE_NM          	 = #{pcDetlImgFileNm}
		, PC_DETL_IMG_SIZE             	 = #{pcDetlImgSize}::integer
		, PC_DETL_IMG_ALT              	 = #{pcDetlImgAlt}
		, MOBILE_LIST_IMG_PATH			 = #{mobileListImgPath}
		, MOBILE_LIST_IMG_ORG_FILE_NM    = #{mobileListImgOrgFileNm}
		, MOBILE_LIST_IMG_FILE_NM        = #{mobileListImgFileNm}
		, MOBILE_LIST_IMG_SIZE           = #{mobileListImgSize}::integer
		, MOBILE_LIST_IMG_ALT            = #{mobileListImgAlt}
		, MOBILE_DETL_IMG_PATH		 	 = #{mobileDetlImgPath}
		, MOBILE_DETL_IMG_ORG_FILE_NM  	 = #{mobileDetlImgOrgFileNm}
		, MOBILE_DETL_IMG_FILE_NM      	 = #{mobileDetlImgFileNm}
		, MOBILE_DETL_IMG_SIZE         	 = #{mobileDetlImgSize}::integer
		, MOBILE_DETL_IMG_ALT          	 = #{mobileDetlImgAlt}
		, EVT_DETL_CONTENT               = #{evtDetlContent}
		, EVT_STAT_DTM                   = #{evtStatDtm}
		, EVT_END_DTM                    = #{evtEndDtm}
		, NEW_WINDOW_LINK_YN             = #{newWindowLinkYn}
		, NEW_LINK                       = #{newLink}
		, USE_YN                         = #{useYn}
		, UPD_DTM 			       		 = NOW()
		, UPD_PERSON_ID 			     = #{updPersonId}
	WHERE EVT_SEQ_NO = #{evtSeqNo}::integer
	</update>
	
	<delete id="delete" parameterType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO">
		DELETE FROM MK_EVT
		WHERE EVT_SEQ_NO = #{evtSeqNo}::integer
	</delete>
	
	<update id="doSortOrder" parameterType="com.cellosquare.adminapp.admin.event.vo.AdminEventVO">
		UPDATE MK_EVT SET
			ORDB = #{ordb}
		WHERE EVT_SEQ_NO = #{evtSeqNo}::integer
	</update>
</mapper>