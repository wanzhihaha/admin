<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cellosquare.adminapp.admin.goods.mapper.AdminProductsMapper">

	<select id="getTotalCount" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO" resultType="int">
		SELECT COUNT(*)
		FROM mk_products
		WHERE 1=1 and enable_flag = '0'
		AND LANG_CD = #{langCd}
		AND product_ctgry = #{productCtgry}
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(searchValue) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(searchValue)">
			<if test="@com.bluewaves.lab.util.MyBatisUtil@isEquals(searchType, 'search_productNm')">
				AND product_nm ILIKE CONCAT ('%', #{searchValue}, '%')
			</if>
			<if test="@com.bluewaves.lab.util.MyBatisUtil@isEquals(searchType, 'search_InsPersonNm')">
				AND FN_GETMANAGERNM(INS_PERSON_ID) ILIKE CONCAT ('%', #{searchValue}, '%')
			</if>
		</if>
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(useYn) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(useYn)">
			AND USE_YN=#{useYn}
		</if>
	</select>
	
	<select id="getList" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO" resultType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO">
		SELECT
			  A.product_seq_no
			, A.META_SEQ_NO
			, A.LANG_CD
			, A.product_ctgry
			, A.product_nm
			, A.product_summary_info
			, A.PC_LIST_IMG_PATH
			, A.PC_LIST_IMG_ORG_FILE_NM
			, A.PC_LIST_IMG_FILE_NM
			, A.PC_LIST_IMG_SIZE
			, A.PC_LIST_IMG_ALT
			, A.PC_DETL_IMG_PATH
			, A.PC_DETL_IMG_ORG_FILE_NM
			, A.PC_DETL_IMG_FILE_NM
			, A.PC_DETL_IMG_SIZE
			, A.PC_DETL_IMG_ALT
			, A.MOBILE_LIST_IMG_PATH 
			, A.MOBILE_LIST_IMG_ORG_FILE_NM
			, A.MOBILE_LIST_IMG_FILE_NM
			, A.MOBILE_LIST_IMG_SIZE 
			, A.MOBILE_LIST_IMG_ALT
			, A.MOBILE_DETL_IMG_PATH 
			, A.MOBILE_DETL_IMG_ORG_FILE_NM
			, A.MOBILE_DETL_IMG_FILE_NM
			, A.MOBILE_DETL_IMG_SIZE 
			, A.MOBILE_DETL_IMG_ALT

			, A.product_contents

			, A.USE_YN
			, FN_GETCODENM('USE_YN', A.USE_YN, A.LANG_CD) AS USE_YN_NM
			, A.SRCH_CNT
			, A.ORDB
			, TO_CHAR(INS_DTM, 'YYYY-MM-DD') AS INS_DTM 
			, A.INS_PERSON_ID 
			, FN_GETMANAGERNM(A.INS_PERSON_ID) AS INS_PERSON_NM
			, TO_CHAR(UPD_DTM, 'YYYY-MM-DD') AS UPD_DTM
			, A.UPD_PERSON_ID
			, FN_GETMANAGERNM(A.UPD_PERSON_ID) AS UPD_PERSON_NM
		FROM mk_products A
		WHERE 1=1 and A.enable_flag = '0'
		AND A.LANG_CD = #{langCd}
		AND A.product_ctgry = #{productCtgry}
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(searchValue) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(searchValue)">
			<if test="@com.bluewaves.lab.util.MyBatisUtil@isEquals(searchType, 'search_productNm')">
				AND A.product_nm ILIKE CONCAT ('%', #{searchValue}, '%')
			</if>
			<if test="@com.bluewaves.lab.util.MyBatisUtil@isEquals(searchType, 'search_InsPersonNm')">
				AND FN_GETMANAGERNM(A.INS_PERSON_ID) ILIKE CONCAT ('%', #{searchValue}, '%')
			</if>
		</if>
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(useYn) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(useYn)">
			AND A.USE_YN=#{useYn}
		</if>
	ORDER BY A.ordb::integer asc , A.product_seq_no DESC
	LIMIT #{endRow} OFFSET #{startRow}
	</select>
	
	<update id="doSortOrder" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO">
		UPDATE mk_products SET
			ORDB = #{ordb}
		WHERE 1=1
		AND product_ctgry = #{productCtgry}
		AND product_seq_no = #{productSeqNo}::integer
	</update>
	<select id="getDetail" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO" resultType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO">
		SELECT
			  A.product_seq_no
			, A.META_SEQ_NO
			, A.LANG_CD
			, A.product_ctgry
			, FN_GETCODENM('GOODS_DIV', A.product_ctgry, A.LANG_CD) product_ctgry_NM
			, A.product_nm
			, A.product_summary_info
			, A.PC_LIST_IMG_PATH
			, A.PC_LIST_IMG_ORG_FILE_NM
			, A.PC_LIST_IMG_FILE_NM
			, A.PC_LIST_IMG_SIZE
			, A.PC_LIST_IMG_ALT
			, A.PC_DETL_IMG_PATH
			, A.PC_DETL_IMG_ORG_FILE_NM
			, A.PC_DETL_IMG_FILE_NM
			, A.PC_DETL_IMG_SIZE
			, A.PC_DETL_IMG_ALT
			, A.MOBILE_LIST_IMG_PATH 
			, A.MOBILE_LIST_IMG_ORG_FILE_NM
			, A.MOBILE_LIST_IMG_FILE_NM
			, A.MOBILE_LIST_IMG_SIZE 
			, A.MOBILE_LIST_IMG_ALT
			, A.MOBILE_DETL_IMG_PATH 
			, A.MOBILE_DETL_IMG_ORG_FILE_NM
			, A.MOBILE_DETL_IMG_FILE_NM
			, A.MOBILE_DETL_IMG_SIZE 
			, A.MOBILE_DETL_IMG_ALT
			, A.product_contents
			, A.USE_YN
			, FN_GETCODENM('USE_YN', A.USE_YN, A.LANG_CD) AS USE_YN_NM
			, A.SRCH_CNT
			, A.ORDB
			, TO_CHAR(INS_DTM, 'YYYY-MM-DD') AS INS_DTM 
			, A.INS_PERSON_ID 
			, FN_GETMANAGERNM(A.INS_PERSON_ID) AS INS_PERSON_NM
			, TO_CHAR(UPD_DTM, 'YYYY-MM-DD') AS UPD_DTM
			, A.UPD_PERSON_ID
			, FN_GETMANAGERNM(A.UPD_PERSON_ID) AS UPD_PERSON_NM
		,ack_question
		FROM mk_products A
		WHERE 1=1
		AND A.product_seq_no = #{productSeqNo}::integer
	</select>


	<insert id="regist" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO" useGeneratedKeys="true" keyProperty="productSeqNo">
	INSERT INTO mk_products (
		  META_SEQ_NO
		, LANG_CD
		, product_ctgry
		, product_nm
		, product_summary_info
		, PC_LIST_IMG_PATH
		, PC_LIST_IMG_ORG_FILE_NM
		, PC_LIST_IMG_FILE_NM
		, PC_LIST_IMG_SIZE
		, PC_LIST_IMG_ALT
		, PC_DETL_IMG_PATH
		, PC_DETL_IMG_ORG_FILE_NM
		, PC_DETL_IMG_FILE_NM
		, PC_DETL_IMG_SIZE
		, PC_DETL_IMG_ALT
		, MOBILE_DETL_IMG_PATH
		, MOBILE_DETL_IMG_ORG_FILE_NM
		, MOBILE_DETL_IMG_FILE_NM
		, MOBILE_DETL_IMG_SIZE
		, MOBILE_DETL_IMG_ALT

		, product_contents

		, USE_YN
		, INS_DTM
		, INS_PERSON_ID
		, UPD_DTM
		, UPD_PERSON_ID
		, ack_question
	) VALUES (
		  #{metaSeqNo}::integer
		, #{langCd}
		, #{productCtgry}
		, #{productNm}

		, #{productSummaryInfo}
		, #{pcListImgPath}
		, #{pcListImgOrgFileNm}
		, #{pcListImgFileNm}
		, #{pcListImgSize}::integer
		, #{pcListImgAlt}
		, #{pcDetlImgPath}
		, #{pcDetlImgOrgFileNm}
		, #{pcDetlImgFileNm}
		, #{pcDetlImgSize}::integer
		, #{pcDetlImgAlt}
		 , #{mobileDetlImgPath}
		 , #{mobileDetlImgOrgFileNm}
		 , #{mobileDetlImgFileNm}
		 , #{mobileDetlImgSize}::integer
		 , #{mobileDetlImgAlt}
		, #{productContents}
		, #{useYn}
		, NOW()
		, #{insPersonId}
		, NOW()
		, #{updPersonId}
		, #{ackQuestion}
	)
	</insert>

	<select id="getProductCountByNm" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO" resultType="int">
		SELECT
			count(1)
		FROM mk_products
		WHERE product_nm = #{productNm}
		<if test="@com.bluewaves.lab.util.MyBatisUtil@isNotNull(productSeqNo) and @com.bluewaves.lab.util.MyBatisUtil@isNotEmpty(productSeqNo)">
		and product_seq_no != #{productSeqNo}::integer

		</if>
		and enable_flag = '0'
	</select>

	<select id="getGoodsNm" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO" resultType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO">
		SELECT 
			  product_seq_no
			, product_nm 
			, product_ctgry
		FROM mk_products 
		WHERE product_seq_no = #{productSeqNo}::integer
	</select>
	
	<update id="doUpdate" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO">
	UPDATE mk_products
	SET
		  product_nm						= #{productNm}
		, product_summary_info            = #{productSummaryInfo}
		, PC_LIST_IMG_PATH			    = #{pcListImgPath}
		, PC_LIST_IMG_ORG_FILE_NM       = #{pcListImgOrgFileNm}
		, PC_LIST_IMG_FILE_NM           = #{pcListImgFileNm}
		, PC_LIST_IMG_SIZE              = #{pcListImgSize}::integer
		, PC_LIST_IMG_ALT               = #{pcListImgAlt}
		, PC_DETL_IMG_PATH			 	= #{pcDetlImgPath}
		, PC_DETL_IMG_ORG_FILE_NM      	= #{pcDetlImgOrgFileNm}
		, PC_DETL_IMG_FILE_NM          	= #{pcDetlImgFileNm}
		, PC_DETL_IMG_SIZE             	= #{pcDetlImgSize}::integer
		, PC_DETL_IMG_ALT              	= #{pcDetlImgAlt}
		, MOBILE_LIST_IMG_PATH			 = #{mobileListImgPath}
		, MOBILE_LIST_IMG_ORG_FILE_NM    = #{mobileListImgOrgFileNm}
		, MOBILE_LIST_IMG_FILE_NM        = #{mobileListImgFileNm}
		, MOBILE_LIST_IMG_SIZE           = #{mobileListImgSize}::integer
		, MOBILE_LIST_IMG_ALT            = #{mobileListImgAlt}
		, MOBILE_DETL_IMG_PATH		 	 = #{mobileDetlImgPath}
		, MOBILE_DETL_IMG_ORG_FILE_NM  	 = #{mobileDetlImgOrgFileNm}
		, MOBILE_DETL_IMG_FILE_NM      	 = #{mobileDetlImgFileNm}
		, MOBILE_DETL_IMG_SIZE         	 = #{mobileDetlImgSize}::integer
		, MOBILE_DETL_IMG_ALT          	 = #{mobileDetlImgAlt}
		, product_contents           = #{productContents}
		, USE_YN                        = #{useYn}
		, UPD_DTM 			       		= NOW()
		, UPD_PERSON_ID 			    = #{updPersonId}
		, ack_question 			    = #{ackQuestion}
	WHERE product_seq_no = #{productSeqNo}::integer
	AND product_ctgry = #{productCtgry}
	</update>
	
	<delete id="delete" parameterType="com.cellosquare.adminapp.admin.goods.vo.AdminProductsVO">
		delete from  mk_products
		WHERE  product_seq_no = #{productSeqNo}::integer
		AND product_ctgry = #{productCtgry}
	</delete>
</mapper>